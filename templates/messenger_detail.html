{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="chat-container"
     id="chat-container"
     data-interlocutor-id="{{ interlocutor.id }}"
     data-user-id="{{ user.id }}" {# <-- Используем переменную user из контекста #}
     data-ws-url-base="{{ ws_url_base }}/"> {# <-- Используем вычисленный URL и добавляем конечный слэш #}
    <h2>Диалог с {{ interlocutor.full_name }}</h2>

    <div class="messages" id="messages">
        {# ... сообщения загружаются здесь ... #}
        {% comment %} Сообщения должны быть выведены здесь из переменной messages контекста, если вы их передаете {% endcomment %}
         {% for message in messages %}
             <div class="message {% if message.sender == user %}sent{% else %}received{% endif %}">
                 <div>{{message.sender.full_name}} </div>
                 <div class="message-content">{{ message.text }}</div>
                 <div class="message-time">{{ message.timestamp|date:"H:i" }}</div> {# Пример форматирования времени #}
             </div>
         {% empty %}
             <p>Начните диалог!</p>
         {% endfor %}
    </div>

    <form id="message-form" class="message-form">
        {% csrf_token %}
        <input type="text"
               id="message-input"
               placeholder="Введите сообщение..."
               autocomplete="off">
        <button type="submit">Отправить</button>
    </form>
</div>

{% load static %}
<script src="{% static 'js/messenger.js' %}"></script>
{% endblock %}
